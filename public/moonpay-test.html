<!DOCTYPE html>
<html>
<head>
    <title>MoonPay Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="font-family: system-ui; padding: 20px; max-width: 400px; margin: 50px auto;">
    <h2>MoonPay Activation</h2>
    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <strong>Test Card:</strong><br>
        4000 0209 5159 5032<br>
        Exp: 12/25 • CVV: 123<br>
        <small>Purchase $100 ETH (test only)</small>
    </div>
    
    <button onclick="startTest()" style="background: #2962FF; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%;">
        Start Test Transaction
    </button>
    
    <div id="status" style="margin-top: 20px;"></div>
    
    <!-- Load MoonPay SDK properly -->
    <script src="https://static.moonpay.com/web-sdk/v1/moonpay-web-sdk.min.js"></script>
    <script>
        async function startTest() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Loading MoonPay...';
            
            try {
                // Check if SDK loaded
                if (typeof window.MoonPayWebSdk === 'undefined') {
                    throw new Error('MoonPay SDK not loaded. Please refresh and try again.');
                }
                
                // Initialize MoonPay
                const moonPay = await window.MoonPayWebSdk.init({
                    flow: 'buy',
                    environment: 'sandbox',
                    variant: 'overlay',
                    params: {
                        apiKey: 'pk_test_1Ggn4ZC8XVyBJhHROwNJbAMqKHpJuCv',
                        baseCurrencyCode: 'usd',
                        baseCurrencyAmount: '100',
                        defaultCurrencyCode: 'eth',
                        theme: 'light'
                    }
                });
                
                // Show the widget
                moonPay.show();
                statusDiv.innerHTML = '✓ Widget opened! Complete the test purchase.';
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.innerHTML = 'Error: ' + error.message;
            }
        }
        
        // Check SDK loading on page load
        window.addEventListener('load', function() {
            const statusDiv = document.getElementById('status');
            if (typeof window.MoonPayWebSdk !== 'undefined') {
                statusDiv.innerHTML = 'Ready to start test transaction';
            } else {
                statusDiv.innerHTML = 'MoonPay SDK loading... Please wait a moment.';
                // Try loading again
                setTimeout(function() {
                    if (typeof window.MoonPayWebSdk !== 'undefined') {
                        statusDiv.innerHTML = 'Ready to start test transaction';
                    } else {
                        statusDiv.innerHTML = 'Error loading MoonPay. Please refresh the page.';
                    }
                }, 2000);
            }
        });
    </script>
</body>
</html>