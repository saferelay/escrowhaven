<!DOCTYPE html>
<html>
<head>
    <title>MoonPay Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="font-family: system-ui; padding: 20px; max-width: 400px; margin: 50px auto;">
    <h2>MoonPay Activation</h2>
    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <strong>Test Card:</strong><br>
        4000 0209 5159 5032<br>
        Exp: 12/25 • CVV: 123<br>
        <small>Purchase $100 ETH (test only)</small>
    </div>
    
    <button onclick="startTest()" style="background: #2962FF; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%;">
        Start Test Transaction
    </button>
    
    <button onclick="openInNewTab()" style="background: #16a34a; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px;">
        Open in New Tab (If overlay fails)
    </button>
    
    <div id="status" style="margin-top: 20px; padding: 10px; border-radius: 4px;"></div>
    
    <script src="https://static.moonpay.com/web-sdk/v1/moonpay-web-sdk.min.js"></script>
    <script>
        // Check SDK loaded
        window.addEventListener('load', function() {
            const statusDiv = document.getElementById('status');
            if (window.MoonPayWebSdk) {
                statusDiv.style.background = '#dcfce7';
                statusDiv.innerHTML = '✓ SDK loaded successfully';
            }
        });
        
        function startTest() {
            const statusDiv = document.getElementById('status');
            
            try {
                // Use the init method as shown in console
                const widget = window.MoonPayWebSdk.init({
                    flow: 'buy',
                    environment: 'sandbox',
                    variant: 'overlay',
                    params: {
                        apiKey: 'pk_test_1Ggn4ZC8XVyBJhHROwNJbAMqKHpJuCv',
                        baseCurrencyCode: 'usd',
                        baseCurrencyAmount: '100',
                        defaultCurrencyCode: 'eth'
                    }
                });
                
                widget.show();
                statusDiv.style.background = '#dbeafe';
                statusDiv.innerHTML = 'Widget opened! Complete the test transaction.';
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.style.background = '#fee2e2';
                statusDiv.innerHTML = 'Error: ' + error.message + '<br>Try the "Open in New Tab" button instead.';
            }
        }
        
        function openInNewTab() {
            // Fallback: Open directly in new tab to bypass any CSP issues
            window.open('https://buy-sandbox.moonpay.com/?apiKey=pk_test_1Ggn4ZC8XVyBJhHROwNJbAMqKHpJuCv&defaultCurrencyCode=eth&baseCurrencyAmount=100&baseCurrencyCode=usd', '_blank');
            
            const statusDiv = document.getElementById('status');
            statusDiv.style.background = '#dbeafe';
            statusDiv.innerHTML = 'Opened in new tab. Complete the test transaction there.';
        }
    </script>
</body>
</html>